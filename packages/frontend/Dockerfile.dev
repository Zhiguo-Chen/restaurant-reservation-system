# Development Dockerfile with hot reload
FROM node:22-alpine

# Set working directory
WORKDIR /app

# Copy root package.json for workspace configuration
COPY package.json ./

# Copy shared package
COPY packages/shared ./packages/shared

# Copy frontend package files
COPY packages/frontend/package*.json ./packages/frontend/
COPY packages/frontend/vite.config.ts ./packages/frontend/
COPY packages/frontend/tsconfig.json ./packages/frontend/
COPY packages/frontend/tsconfig.node.json ./packages/frontend/
COPY packages/frontend/index.html ./packages/frontend/

# Install dependencies from root (handles workspaces)
RUN npm install

# Build shared package if it exists
RUN if [ -f "packages/shared/package.json" ]; then npm run build -w @restaurant-reservation/shared; fi

# Set working directory to frontend
WORKDIR /app/packages/frontend

# Install frontend dependencies specifically
RUN npm install

# Copy frontend source code
COPY packages/frontend .

# Expose port
EXPOSE 3000

# Start development server
CMD ["npm", "run", "dev", "--", "--host", "0.0.0.0"]