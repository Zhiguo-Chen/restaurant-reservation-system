# Development Dockerfile with hot reload
FROM node:22-alpine

# Set working directory
WORKDIR /app

# Install system dependencies
RUN apk add --no-cache curl

# Copy root package.json for workspace configuration
COPY package.json ./

# Copy shared package
COPY packages/shared ./packages/shared

# Copy backend package files
COPY packages/backend/package*.json ./packages/backend/
COPY packages/backend/tsconfig.json ./packages/backend/

# Install dependencies from root (handles workspaces)
RUN npm install

# Build shared package
RUN npm run build -w @restaurant-reservation/shared

# Set working directory to backend
WORKDIR /app/packages/backend

# Copy backend source code
COPY packages/backend .

# Expose port
EXPOSE 4000

# Health check
HEALTHCHECK --interval=30s --timeout=3s --start-period=5s --retries=3 \
  CMD curl -f http://localhost:4000/health || exit 1

# Start development server with hot reload
CMD ["npm", "run", "dev"]